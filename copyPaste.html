<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CopyPaste</title>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

</head>

<body onload="loadSentence()">
  <div class="m-2 p-2 card">
    <section>
      <h1 style="font-size: 20px;">Copy-Pasting</h1>
      <div>Please copy the <span style="color: red; font-weight: bold;" id='selected'> </span> sentences in the
        following text into
        the answer textarea

      </div>
      <div>Be careful not to copy the serial number.</div>
      <a class="btn btn-primary m-1" id='show-btn' href="#" role="button">Show Sentences</a>


      <div class='card m-1 p-1' id="listContainer" style="height: 90px;">
      </div>
      <div class="m-1">
        <label class="form-label">Answer Textarea</label>
        <textarea class="form-control" id="textarea" rows="3"></textarea>
      </div>
      <a class="btn btn-primary m-1" id='submit-btn' href="#" role="button">Submit</a>
      <a class="btn btn-primary m-1" id='restart-btn' href="#" role="button">Restart</a>
      <a class="btn btn-primary m-1" id='download-btn' href="#" role="button">Download</a>

      <div id="messagec" style="display: none;">Your answer is correct!</div>
      <div id="messagew" style="display: none;">Your answer is wrong!</div>


    </section>
  </div>
  <script>
    let index, correctAnswer, startTime
    let count = 0
    let correctNum = 0
    const listContainer = $('#listContainer')
    let completionTime = []
    let ans = []
    const showList = [
      'This is test 1.',
      'This is test 2.',
      'This is test 3.',
      'This is test 4.',
      'This is test 5.',
      'This is test 6.',
      'This is test 7.',
      'This is test 8.',
      'This is test 9.',
      'This is test 10.'
    ]
    const numberToText = {
      0: 'first',
      1: 'second',
      2: 'third'
    }

    function shuffle(array) {
      array.sort(() => Math.random() - 0.5)
    }

    $('#show-btn').on('click', function () {
      listContainer.empty()
      shuffle(showList)
      console.log(showList);
      const ol = $('<ol>')

      for (let i = 0; i < 3; i++) {
        const li = $('<li>').text(showList[i])
        ol.append(li)
      }
      correctAnswer = showList[index]
      console.log(correctAnswer);
      listContainer.append(ol)
      // start to count
      startTime = new Date();
      console.log(startTime);
    })

    function loadSentence() {
      index = Math.floor(Math.random() * 3)
      console.log(index)
      $("#selected").text(numberToText[index]);
      listContainer.text('Please click the above button to show sentences')

    }

    $('#submit-btn').on('click', function () {
      // end count
      let endTime = new Date()
      let elapsedTime = endTime - startTime
      console.log(elapsedTime);
      completionTime.push(elapsedTime)

      // check if correct
      count++
      console.log(count);
      if ($('#textarea').val() == correctAnswer) {
        correctNum++
        ans.push(true)
        $("#messagec").show()
      } else {
        ans.push(false)
        $("#messagew").show()

      }
      $('#textarea').val('');

    })

    $('#restart-btn').on('click', function () {
      $('#messagec').hide()
      $("#messagew").hide()
      loadSentence()
    })

    $('#download-btn').on('click', function () {
      let fileContent = ''
      // let sum = 0;
      // completionTime.forEach((val) => {
      //   sum += val;
      // });
      // let average = sum / completionTime.length
      const filename = `record.txt`;
      for (let i = 0; i < completionTime.length; i++) {
        fileContent += completionTime[i] + ' ' + ans[i] + '\n'
      }
      // fileContent = `Completion Time ${completionTime}\n Average ${average}\nCorrect Answer ${correctNum}:\n Times Tried ${count}:\n`;
      downloadFile(filename, fileContent);
    })

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
<style>
  .on {
    color: red;
  }

  ol {
    margin-bottom: 0;
  }
</style>

</html>